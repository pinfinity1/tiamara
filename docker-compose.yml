services:
  postgres:
    image: postgres:13
    restart: always
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password # <-- این مقادیر را در سرور حتما تغییر دهید!
      POSTGRES_DB: nextecommerce
    volumes:
      - postgres-data:/var/lib/postgresql/data
    # پورت 5436 را فقط در صورتی باز بگذارید که می‌خواهید از بیرون سرور به دیتابیس وصل شوید
    # ports:
    #   - "5436:5432"

  # سرویس بک‌اند (Server)
  server:
    # این آدرس ایمیج شما در رجیستری خواهد بود (در فاز CI/CD ساخته می‌شود)
    image: ghcr.io/YOUR_REGISTRY_USERNAME/tiamara-server:latest
    restart: always
    ports:
      - "5000:5000" # پورت داخلی 5000 را به پورت 5000 سرور مپ می‌کند
    environment:
      # آدرس دیتابیس که به سرویس 'postgres' اشاره می‌کند
      DATABASE_URL: "postgresql://user:password@postgres:5432/nextecommerce"
      # ... سایر متغیرهای محیطی مورد نیاز سرور (JWT_SECRET و ...)
    depends_on:
      - postgres # اول دیتابیس اجرا شود

  # سرویس فرانت‌اند (Client)
  client:
    # این آدرس ایمیج شما در رجیستری خواهد بود
    image: ghcr.io/YOUR_REGISTRY_USERNAME/tiamara-client:latest
    restart: always
    ports:
      - "3000:3000" # پورت داخلی 3000 را به پورت 3000 سرور مپ می‌کند
    depends_on:
      - server # اول سرور اجرا شود

volumes:
  postgres-data:
